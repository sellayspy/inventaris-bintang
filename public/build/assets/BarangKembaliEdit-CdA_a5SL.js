import{a as w,u as C,r as b,j as e,L as $}from"./app-CqDem4Iv.js";import{A as K}from"./app-layout-CO-j32QL.js";import{S as N}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-D25-2m8W.js";import"./index-B3PMF5vv.js";import"./index-D3xMyuYw.js";import"./index-DQS2yhzL.js";import"./x-skuTRX_H.js";import"./createLucideIcon-nI3AvfOo.js";import"./floating-ui.react-dom-BcAq-xRk.js";const O=({item:s,index:i,onItemChange:r,onRemove:n,lokasiId:d})=>{const[h,u]=b.useState([]),[k,x]=b.useState([]),[j,f]=b.useState([]),[v,t]=b.useState([]),[m,p]=b.useState([]);b.useEffect(()=>{d&&(fetch(`/api/kategori-by-lokasi/${d}`).then(a=>a.json()).then(u),s.kategori&&fetch(`/api/merek-by-kategori/${d}/${encodeURIComponent(s.kategori)}`).then(a=>a.json()).then(x),s.merek&&fetch(`/api/model-by-merek/${d}/${encodeURIComponent(s.merek)}`).then(a=>a.json()).then(f),s.model&&fetch(`/api/serial-by-model/${d}/${encodeURIComponent(s.model)}`).then(a=>a.json()).then(a=>{const o=s.kembali_info.map(g=>g.serial_number),l=[...new Set([...a,...o])];t(l)}))},[d,s.kategori,s.merek,s.model]);const c=(a,o)=>{const l={...s,[a]:o};a==="kategori"?(l.merek="",l.model="",l.kembali_info=[{serial_number:"",kondisi:"bagus"}]):a==="merek"?(l.model="",l.kembali_info=[{serial_number:"",kondisi:"bagus"}]):a==="model"&&(l.kembali_info=[{serial_number:"",kondisi:"bagus"}]),r(i,l)},_=(a,o,l)=>{const g=[...s.kembali_info];g[a]={...g[a],[o]:l},r(i,{...s,kembali_info:g})},y=()=>r(i,{...s,kembali_info:[...s.kembali_info,{serial_number:"",kondisi:"bagus"}]}),S=a=>r(i,{...s,kembali_info:s.kembali_info.filter((o,l)=>l!==a)});return e.jsxs("div",{className:"relative mb-6 rounded-lg border-2 border-gray-200 p-4",children:[e.jsxs("h3",{className:"mb-3 text-lg font-semibold text-gray-700",children:["Item Pengembalian #",i+1]}),n&&e.jsx("button",{type:"button",onClick:n,className:"absolute top-2 right-2 font-bold text-red-500 hover:text-red-700",children:"Ã— Hapus Item"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Kategori"}),e.jsx("input",{type:"text",list:`kategori-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.kategori,onChange:a=>c("kategori",a.target.value),disabled:!d}),e.jsx("datalist",{id:`kategori-suggest-${i}`,children:h.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Merek"}),e.jsx("input",{type:"text",list:`merek-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.merek,onChange:a=>c("merek",a.target.value),disabled:!s.kategori}),e.jsx("datalist",{id:`merek-suggest-${i}`,children:k.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Model"}),e.jsx("input",{type:"text",list:`model-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.model,onChange:a=>c("model",a.target.value),disabled:!s.merek}),e.jsx("datalist",{id:`model-suggest-${i}`,children:j.map(a=>e.jsx("option",{value:a.nama},a.id))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-red-700",children:"Serial Number & Kondisi"}),s.kembali_info.map((a,o)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded border-2 border-red-400 bg-red-50 p-2",value:a.serial_number,onChange:l=>_(o,"serial_number",l.target.value),placeholder:`Serial #${o+1}`,list:`serial-suggest-${i}`,disabled:!s.model}),s.kembali_info.length>1&&e.jsx("button",{type:"button",className:"text-sm text-red-600 hover:underline",onClick:()=>S(o),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.kondisi,onChange:l=>_(o,"kondisi",l.target.value),className:"w-full rounded border-2 border-blue-400 bg-blue-50 p-2",children:[e.jsx("option",{value:"bagus",children:"Bagus"}),e.jsx("option",{value:"rusak",children:"Rusak"}),e.jsx("option",{value:"diperbaiki",children:"Diperbaiki"})]})})]},o)),e.jsx("datalist",{id:`serial-suggest-${i}`,children:v.filter(a=>!s.kembali_info.some(o=>o.serial_number===a)||a===s.kembali_info[0]?.serial_number).map(a=>e.jsx("option",{value:a},a))}),e.jsx("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:underline",onClick:y,disabled:!s.model,children:"+ Tambah Serial"})]})]})};function H(){const{barangKembali:s,lokasiList:i}=w().props,{data:r,setData:n,put:d,processing:h,errors:u}=C({tanggal:s.tanggal,lokasi:s.lokasi,items:s.items}),k=i.find(t=>t.nama===r.lokasi)?.id||null;b.useEffect(()=>{r.lokasi!==s.lokasi&&n("items",[{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}])},[r.lokasi]);const x=(t,m)=>{n("items",r.items.map((p,c)=>c===t?m:p))},j=()=>{n("items",[...r.items,{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}])},f=t=>{n("items",r.items.filter((m,p)=>p!==t))},v=t=>{t.preventDefault(),d(route("barang-kembali.update",s.id),{onSuccess:()=>N.fire({icon:"success",title:"Berhasil",text:"Data barang kembali berhasil diperbarui!",timer:2e3,showConfirmButton:!1}),onError:m=>N.fire({icon:"error",title:"Gagal",text:Object.values(m)[0]||"Periksa kembali isian form Anda."})})};return e.jsx(K,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Edit Transaksi Barang Kembali"}),e.jsxs("form",{onSubmit:v,className:"rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b pb-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Tanggal Pengembalian"}),e.jsx("input",{type:"date",className:"mt-1 w-full rounded border p-2",value:r.tanggal,onChange:t=>n("tanggal",t.target.value)}),u.tanggal&&e.jsx("p",{className:"text-sm text-red-500",children:u.tanggal})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Lokasi Asal Barang (Tempat Kembali)"}),e.jsx("input",{type:"text",list:"lokasi-suggest",className:"mt-1 w-full rounded border p-2",value:r.lokasi,onChange:t=>n("lokasi",t.target.value)}),e.jsx("datalist",{id:"lokasi-suggest",children:i.map(t=>e.jsx("option",{value:t.nama},t.id))}),u.lokasi&&e.jsx("p",{className:"text-sm text-red-500",children:u.lokasi})]})]}),r.items.map((t,m)=>e.jsx(O,{item:t,index:m,onItemChange:x,onRemove:r.items.length>1?()=>f(m):void 0,lokasiId:k},m)),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:j,className:"rounded bg-green-500 px-4 py-2 text-white hover:bg-green-600",disabled:!r.lokasi,children:"+ Tambah Item"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx($,{href:route("barang-kembali.index"),className:"rounded bg-gray-500 px-6 py-2 text-white hover:bg-gray-600",children:"Kembali"}),e.jsx("button",{type:"submit",disabled:h,className:"rounded bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:"Perbarui Transaksi"})]})]})]})]})})}export{H as default};

import{a as B,u as M,r as d,j as e,L as P}from"./app-B0SzeqCG.js";import{s as K,B as O}from"./TransactionPreview-C4GSCON2.js";import{A as E}from"./app-layout-BnD_lHqo.js";import{S as z}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-CWmUjKFj.js";import"./index-BAI3dK1t.js";import"./index-DjSeiq0_.js";import"./index-wkndwqac.js";import"./x-Ce74WkcZ.js";import"./createLucideIcon-DF5AlWng.js";import"./floating-ui.react-dom-Cbmwftv2.js";const R=({item:r,index:s,onItemChange:o,onRemove:b,lokasiId:l})=>{const[g,u]=d.useState([]),[h,k]=d.useState([]),[p,x]=d.useState([]),[f,t]=d.useState([]),[m,c]=d.useState(!1),[y,w]=d.useState(!1),[S,N]=d.useState(!1);d.useEffect(()=>{l?(c(!0),fetch(`/api/kategori-by-lokasi/${l}`).then(a=>a.json()).then(u).finally(()=>c(!1))):u([])},[l]),d.useEffect(()=>{l&&r.kategori?(w(!0),fetch(`/api/merek-by-kategori/${l}/${encodeURIComponent(r.kategori)}`).then(a=>a.json()).then(k).finally(()=>w(!1))):k([])},[l,r.kategori]),d.useEffect(()=>{l&&r.merek?(N(!0),fetch(`/api/model-by-merek/${l}/${encodeURIComponent(r.merek)}`).then(a=>a.json()).then(x).finally(()=>N(!1))):x([])},[l,r.merek]),d.useEffect(()=>{l&&r.model?fetch(`/api/serial-by-model/${l}/${encodeURIComponent(r.model)}`).then(a=>a.json()).then(t):t([])},[l,r.model]);const j=(a,n)=>{const i={...r,[a]:n};a==="kategori"?(i.merek="",i.model="",i.kembali_info=[{serial_number:"",kondisi:"bagus"}]):a==="merek"?(i.model="",i.kembali_info=[{serial_number:"",kondisi:"bagus"}]):a==="model"&&(i.kembali_info=[{serial_number:"",kondisi:"bagus"}]),o(s,i)},_=(a,n,i)=>{const v=[...r.kembali_info];v[a]={...v[a],[n]:i},o(s,{...r,kembali_info:v})},C=()=>o(s,{...r,kembali_info:[...r.kembali_info,{serial_number:"",kondisi:"bagus"}]}),L=a=>o(s,{...r,kembali_info:r.kembali_info.filter((n,i)=>i!==a)}),$=a=>{const n=[...r.kembali_info.filter(i=>i.serial_number.trim()),...a.map(i=>({serial_number:i,kondisi:"bagus"}))];o(s,{...r,kembali_info:n.length>0?n:[{serial_number:"",kondisi:"bagus"}]})};return e.jsxs("div",{className:"relative mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-zinc-700 dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b border-gray-100 pb-3 dark:border-zinc-800",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Item Pengembalian #",s+1]}),b&&e.jsx("button",{type:"button",onClick:b,className:"rounded-md bg-red-50 px-3 py-1 text-sm font-medium text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30",children:"Ã— Hapus"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Kategori",m&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(memuat...)"})]}),e.jsx("input",{type:"text",list:`kategori-suggest-${s}`,className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:r.kategori,onChange:a=>j("kategori",a.target.value),disabled:!l,placeholder:l?"Pilih kategori...":"Pilih lokasi dulu"}),e.jsx("datalist",{id:`kategori-suggest-${s}`,children:g.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Merek",y&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(memuat...)"})]}),e.jsx("input",{type:"text",list:`merek-suggest-${s}`,className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:r.merek,onChange:a=>j("merek",a.target.value),disabled:!r.kategori,placeholder:r.kategori?"Pilih merek...":"Pilih kategori dulu"}),e.jsx("datalist",{id:`merek-suggest-${s}`,children:h.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Model",S&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(memuat...)"})]}),e.jsx("input",{type:"text",list:`model-suggest-${s}`,className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:r.model,onChange:a=>j("model",a.target.value),disabled:!r.merek,placeholder:r.merek?"Pilih model...":"Pilih merek dulu"}),e.jsx("datalist",{id:`model-suggest-${s}`,children:p.map(a=>e.jsx("option",{value:a.nama},a.id))})]})]}),e.jsxs("div",{className:"mt-5 rounded-lg border border-gray-200 bg-gray-50/50 p-4 dark:border-zinc-700 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:["Serial Number & Kondisi",e.jsxs("span",{className:"ml-2 rounded-full bg-green-100 px-2 py-0.5 text-xs text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[r.kembali_info.filter(a=>a.serial_number.trim()).length," unit"]})]}),e.jsx(O,{existingSerials:r.kembali_info.map(a=>a.serial_number),onSerialsParsed:$})]}),r.kembali_info.map((a,n)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:a.serial_number,onChange:i=>_(n,"serial_number",i.target.value),placeholder:`Serial #${n+1}`,list:`serial-suggest-${s}`,disabled:!r.model}),r.kembali_info.length>1&&e.jsx("button",{type:"button",className:"rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400",onClick:()=>L(n),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.kondisi,onChange:i=>_(n,"kondisi",i.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",children:[e.jsx("option",{value:"bagus",children:"Bagus"}),e.jsx("option",{value:"rusak",children:"Rusak"}),e.jsx("option",{value:"diperbaiki",children:"Diperbaiki"})]})})]},n)),e.jsx("datalist",{id:`serial-suggest-${s}`,children:f.filter(a=>!r.kembali_info.some(n=>n.serial_number===a)).map(a=>e.jsx("option",{value:a},a))}),e.jsxs("button",{type:"button",className:"mt-2 inline-flex items-center gap-1 rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-gray-300 dark:hover:bg-zinc-700",onClick:C,disabled:!r.model,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Serial"]})]})]})};function X(){const{lokasiList:r}=B().props,{data:s,setData:o,post:b,processing:l,errors:g,reset:u}=M({tanggal:new Date().toISOString().slice(0,10),lokasi:"",items:[{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}]}),h=r.find(t=>t.nama===s.lokasi)?.id||null;d.useEffect(()=>{o("items",[{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}])},[s.lokasi]);const k=(t,m)=>{o("items",s.items.map((c,y)=>y===t?m:c))},p=()=>{o("items",[...s.items,{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}])},x=t=>{o("items",s.items.filter((m,c)=>c!==t))},f=async t=>{t.preventDefault(),await K(s,"kembali")&&b(route("barang-kembali.store"),{onSuccess:()=>{z.fire({icon:"success",title:"Berhasil",text:"Data barang kembali berhasil disimpan!",timer:2e3,showConfirmButton:!1}),u()},onError:c=>z.fire({icon:"error",title:"Gagal",text:Object.values(c)[0]||"Periksa kembali isian form Anda."})})};return e.jsx(E,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 dark:bg-zinc-950",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Buat Transaksi Barang Kembali"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Kembalikan barang yang dipinjam ke gudang"})]}),e.jsxs("form",{onSubmit:f,className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-zinc-700 dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b border-gray-100 pb-6 md:grid-cols-2 dark:border-zinc-800",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tanggal Pengembalian"}),e.jsx("input",{type:"date",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:s.tanggal,onChange:t=>o("tanggal",t.target.value)}),g.tanggal&&e.jsx("p",{className:"text-xs text-red-500",children:g.tanggal})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Lokasi Asal Barang"}),e.jsx("input",{type:"text",list:"lokasi-suggest",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:s.lokasi,onChange:t=>o("lokasi",t.target.value),placeholder:"Pilih lokasi asal barang..."}),e.jsx("datalist",{id:"lokasi-suggest",children:r.map(t=>e.jsx("option",{value:t.nama},t.id))}),g.lokasi&&e.jsx("p",{className:"text-xs text-red-500",children:g.lokasi})]})]}),s.items.map((t,m)=>e.jsx(R,{item:t,index:m,onItemChange:k,onRemove:s.items.length>1?()=>x(m):void 0,lokasiId:h},m)),e.jsxs("div",{className:"mt-8 flex flex-col items-center justify-between gap-4 border-t border-gray-100 pt-6 sm:flex-row dark:border-zinc-800",children:[e.jsxs("button",{type:"button",onClick:p,className:"inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm transition hover:bg-emerald-600 disabled:opacity-50 dark:bg-emerald-600 dark:hover:bg-emerald-700",disabled:!s.lokasi,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Item"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(P,{href:route("barang-kembali.index"),className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-gray-300 dark:hover:bg-zinc-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Kembali"]}),e.jsx("button",{type:"submit",disabled:l,className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-2.5 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Simpan Transaksi"]})})]})]})]})]})})})}export{X as default};

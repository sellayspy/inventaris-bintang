import{a as y,u as C,j as e,L as S,r as u}from"./app-B0SzeqCG.js";import{A as B}from"./app-layout-BnD_lHqo.js";import{S as N}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-CWmUjKFj.js";import"./index-BAI3dK1t.js";import"./index-DjSeiq0_.js";import"./index-wkndwqac.js";import"./x-Ce74WkcZ.js";import"./createLucideIcon-DF5AlWng.js";import"./floating-ui.react-dom-Cbmwftv2.js";const L=({item:s,index:i,onItemChange:g,onRemove:p,errors:_,lists:l})=>{const[c,h]=u.useState([]),[j,m]=u.useState([]),[k,x]=u.useState([]);u.useEffect(()=>{if(!s.kategori){h([]);return}fetch(`/ajax/jenis-barang?kategori=${encodeURIComponent(s.kategori)}`).then(a=>a.json()).then(h)},[s.kategori]),u.useEffect(()=>{if(!s.jenis_barang){m([]);return}fetch(`/ajax/model-barang?jenis_barang=${encodeURIComponent(s.jenis_barang)}`).then(a=>a.json()).then(m)},[s.jenis_barang]),u.useEffect(()=>{if(s.rak_nama){const a=l.rakList.filter(t=>t.nama_rak===s.rak_nama).map(t=>t.baris);x(a)}},[]);const v=a=>{const t=l.rakList.filter(n=>n.nama_rak===a).map(n=>n.baris);x(t),g(i,{...s,rak_nama:a,rak_baris:"",rak_id:null})},f=a=>{const t=l.rakList.find(n=>n.nama_rak===s.rak_nama&&n.baris===a);g(i,{...s,rak_baris:a,rak_id:t?t.id:null})},o=(a,t)=>{const n={...s,[a]:t};a==="kategori"?(n.jenis_barang="",n.model=""):a==="jenis_barang"&&(n.model=""),g(i,n)},r=(a,t)=>{const n=[...s.serial_numbers];n[a]=t,o("serial_numbers",n)},d=()=>o("serial_numbers",[...s.serial_numbers,""]),b=a=>{const t=s.serial_numbers.filter((n,w)=>w!==a);o("serial_numbers",t)};return e.jsxs("div",{className:"relative mb-6 rounded-lg border-2 border-gray-200 p-4",children:[e.jsxs("h3",{className:"mb-3 text-lg font-semibold text-gray-700",children:["Barang #",i+1]}),p&&e.jsx("button",{type:"button",onClick:p,className:"absolute top-2 right-2 font-bold text-red-500 hover:text-red-700",children:"Ã— Hapus Barang"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Kategori"}),e.jsx("input",{type:"text",list:"kategori-suggest",className:"mt-1 w-full rounded border p-2",value:s.kategori,onChange:a=>o("kategori",a.target.value)}),e.jsx("datalist",{id:"kategori-suggest",children:l.kategoriList.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Merek"}),e.jsx("input",{type:"text",list:"merek-suggest",className:"mt-1 w-full rounded border p-2",value:s.merek,onChange:a=>o("merek",a.target.value)}),e.jsx("datalist",{id:"merek-suggest",children:l.merekList.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Jenis Barang"}),e.jsx("input",{type:"text",list:`jenis-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.jenis_barang,onChange:a=>o("jenis_barang",a.target.value)}),e.jsx("datalist",{id:`jenis-suggest-${i}`,children:c.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Model"}),e.jsx("input",{type:"text",list:`model-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.model,onChange:a=>o("model",a.target.value)}),e.jsx("datalist",{id:`model-suggest-${i}`,children:j.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Nama Rak"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.rak_nama,onChange:a=>v(a.target.value),children:[e.jsx("option",{value:"",children:"-- Pilih Rak --"}),[...new Set(l.rakList.map(a=>a.nama_rak))].map(a=>e.jsx("option",{value:a,children:a},a))]})]}),k.length>0&&e.jsxs("div",{children:[e.jsx("label",{children:"Baris"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.rak_baris,onChange:a=>f(a.target.value),children:[e.jsx("option",{value:"",children:"-- Pilih Baris --"}),k.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-red-700",children:"Serial Number"}),s.serial_numbers.map((a,t)=>e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded border-2 border-red-400 bg-red-50 p-2",value:a,onChange:n=>r(t,n.target.value),placeholder:`Serial #${t+1}`}),s.serial_numbers.length>1&&e.jsx("button",{type:"button",className:"text-sm text-red-600 hover:underline",onClick:()=>b(t),children:"Hapus"})]},t)),e.jsx("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:underline",onClick:d,children:"+ Tambah Serial"})]})]})};function J(){const{barangMasuk:s,kategoriList:i,asalList:g,merekList:p,rakList:_}=y().props,{data:l,setData:c,put:h,processing:j,errors:m,reset:k}=C({tanggal:s.tanggal||"",asal_barang:s.asal_barang||"",items:s.items||[]}),x=(r,d)=>{const b=[...l.items];b[r]=d,c("items",b)},v=()=>{const r={kategori:"",merek:"",jenis_barang:"",model:"",rak_nama:"",rak_baris:"",rak_id:null,serial_numbers:[""]};c("items",[...l.items,r])},f=r=>{const d=l.items.filter((b,a)=>a!==r);c("items",d)},o=r=>{r.preventDefault(),h(route("barang-masuk.update",s.id),{onSuccess:()=>{N.fire({icon:"success",title:"Berhasil",text:"Data berhasil diperbarui!",timer:2e3,showConfirmButton:!1})},onError:()=>{N.fire({icon:"error",title:"Gagal",text:"Periksa kembali isian form Anda."})}})};return e.jsx(B,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Edit Transaksi Barang Masuk"}),e.jsxs("form",{onSubmit:o,className:"rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b pb-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal"}),e.jsx("input",{type:"date",className:"mt-1 w-full rounded border p-2",value:l.tanggal,onChange:r=>c("tanggal",r.target.value)}),m.tanggal&&e.jsx("p",{className:"text-sm text-red-500",children:m.tanggal})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Asal Barang"}),e.jsx("input",{type:"text",list:"asal-suggest",className:"mt-1 w-full rounded border p-2",value:l.asal_barang||"",onChange:r=>c("asal_barang",r.target.value)}),e.jsx("datalist",{id:"asal-suggest",children:g.map(r=>e.jsx("option",{value:r.nama},r.id))}),m.asal_barang&&e.jsx("p",{className:"text-sm text-red-500",children:m.asal_barang})]})]}),l.items.map((r,d)=>e.jsx(L,{item:r,index:d,onItemChange:x,onRemove:l.items.length>1?()=>f(d):void 0,errors:m,lists:{kategoriList:i,merekList:p,rakList:_}},d)),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:v,className:"rounded bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"+ Tambah Jenis Barang"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(S,{href:route("barang-masuk.index"),className:"rounded bg-gray-500 px-6 py-2 text-white hover:bg-gray-600",children:"Kembali"}),e.jsx("button",{type:"submit",disabled:j,className:"rounded bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:"Perbarui Transaksi"})]})]})]})]})})}export{J as default};

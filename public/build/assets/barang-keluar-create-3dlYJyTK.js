import{a as B,r as b,u as $,j as e,L as K}from"./app-CqDem4Iv.js";import{s as P,B as I}from"./TransactionPreview-HCgP8qzV.js";import{A as D}from"./app-layout-CO-j32QL.js";import{S as M}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-D25-2m8W.js";import"./index-B3PMF5vv.js";import"./index-D3xMyuYw.js";import"./index-DQS2yhzL.js";import"./x-skuTRX_H.js";import"./createLucideIcon-nI3AvfOo.js";import"./floating-ui.react-dom-BcAq-xRk.js";const F=({item:s,index:o,onItemChange:k,onRemove:p,errors:g,lists:c,usedModels:h})=>{const[C,v]=b.useState(!1),[n,m]=b.useState(!1),f=c.kategoriList.find(a=>a.nama===s.kategori)?.id,j=c.merekList.filter(a=>a.model_barang.some(t=>t.jenis?.kategori_id===f)),d=c.merekList.find(a=>a.nama===s.merek)?.id,w=c.modelList.filter(a=>a.merek_id===d&&a.jenis?.kategori_id===f),N=`${s.merek}|${s.model}`,_=c.serialNumberList[N]||[],z=s.keluar_info.map(a=>a.serial_number),L=_.filter(a=>!z.includes(a)),r=(a,t)=>{const i={...s,[a]:t};a==="kategori"?(i.merek="",i.model="",i.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]):a==="merek"&&(i.model="",i.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]),k(o,i)},l=(a,t,i)=>{const x=[...s.keluar_info];x[a]={...x[a],[t]:i},k(o,{...s,keluar_info:x})},u=()=>{const a=[...s.keluar_info,{serial_number:"",status_keluar:"dipinjamkan"}];k(o,{...s,keluar_info:a})},y=a=>{const t=s.keluar_info.filter((i,x)=>x!==a);k(o,{...s,keluar_info:t})},S=a=>{const t=[...s.keluar_info.filter(i=>i.serial_number.trim()),...a.map(i=>({serial_number:i,status_keluar:"dipinjamkan"}))];k(o,{...s,keluar_info:t.length>0?t:[{serial_number:"",status_keluar:"dipinjamkan"}]})};return e.jsxs("div",{className:"relative mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-zinc-700 dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b border-gray-100 pb-3 dark:border-zinc-800",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Item #",o+1]}),p&&e.jsx("button",{type:"button",onClick:p,className:"rounded-md bg-red-50 px-3 py-1 text-sm font-medium text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30",children:"Ã— Hapus"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Kategori"}),e.jsx("input",{type:"text",list:"kategori-suggest",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:s.kategori,onChange:a=>r("kategori",a.target.value),placeholder:"Pilih atau ketik kategori..."}),e.jsx("datalist",{id:"kategori-suggest",children:c.kategoriList.map(a=>e.jsx("option",{value:a.nama},a.id))}),g.kategori&&e.jsx("p",{className:"text-xs text-red-500",children:g.kategori})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Merek"}),e.jsx("input",{type:"text",list:`merek-suggest-${o}`,className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:s.merek,onChange:a=>r("merek",a.target.value),placeholder:"Pilih atau ketik merek..."}),e.jsx("datalist",{id:`merek-suggest-${o}`,children:j.map(a=>e.jsx("option",{value:a.nama},a.id))}),g.merek&&e.jsx("p",{className:"text-xs text-red-500",children:g.merek})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Model"}),e.jsx("input",{type:"text",list:`model-suggest-${o}`,className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:s.model,onChange:a=>r("model",a.target.value),placeholder:"Pilih atau ketik model..."}),e.jsx("datalist",{id:`model-suggest-${o}`,children:w.map(a=>e.jsx("option",{value:a.nama},a.id))}),g.model&&e.jsx("p",{className:"text-xs text-red-500",children:g.model})]})]}),e.jsxs("div",{className:"mt-5 rounded-lg border border-gray-200 bg-gray-50/50 p-4 dark:border-zinc-700 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:["Serial Number & Status",e.jsxs("span",{className:"ml-2 rounded-full bg-orange-100 px-2 py-0.5 text-xs text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",children:[s.keluar_info.filter(a=>a.serial_number.trim()).length," unit"]})]}),e.jsx(I,{existingSerials:s.keluar_info.map(a=>a.serial_number),onSerialsParsed:S})]}),s.keluar_info.map((a,t)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:a.serial_number,onChange:i=>l(t,"serial_number",i.target.value),placeholder:`Serial #${t+1}`,list:`serial-suggest-${o}-${t}`}),e.jsx("datalist",{id:`serial-suggest-${o}-${t}`,children:L.map(i=>e.jsx("option",{value:i},i))}),s.keluar_info.length>1&&e.jsx("button",{type:"button",className:"rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400",onClick:()=>y(t),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.status_keluar,onChange:i=>l(t,"status_keluar",i.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",children:[e.jsx("option",{value:"dipinjamkan",children:"Dipinjamkan"}),e.jsx("option",{value:"dijual",children:"Dijual"}),e.jsx("option",{value:"maintenance",children:"Maintenance"})]})})]},t)),e.jsxs("button",{type:"button",className:"mt-2 inline-flex items-center gap-1 rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-gray-300 dark:hover:bg-zinc-700",onClick:u,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Serial"]})]})]})};function U(){const{lokasiList:s,kategoriList:o,merekList:k,modelList:p,serialNumberList:g}=B().props,[c,h]=b.useState([]),[C,v]=b.useState(!1),{data:n,setData:m,post:f,processing:j,errors:d,reset:w}=$({tanggal:new Date().toISOString().slice(0,10),lokasi:"",sub_lokasi:"",pic:"",items:[{kategori:"",merek:"",model:"",keluar_info:[{serial_number:"",status_keluar:"dipinjamkan"}]}]});b.useEffect(()=>{if(n.lokasi){const r=s.find(l=>l.nama===n.lokasi)?.id;r?(v(!0),fetch(`/api/sub-lokasi-by-lokasi?lokasi_id=${r}`).then(l=>l.json()).then(l=>{h(l)}).finally(()=>v(!1))):h([])}else h([])},[n.lokasi,s]);const N=(r,l)=>{const u=[...n.items];u[r]=l,m("items",u)},_=()=>{m("items",[...n.items,{kategori:"",merek:"",model:"",keluar_info:[{serial_number:"",status_keluar:"dipinjamkan"}]}])},z=r=>{m("items",n.items.filter((l,u)=>u!==r))},L=async r=>{r.preventDefault(),await P(n,"keluar")&&f(route("barang-keluar.store"),{onSuccess:()=>{M.fire({icon:"success",title:"Berhasil",text:"Data barang keluar berhasil disimpan!",timer:2e3,showConfirmButton:!1}),w()},onError:()=>{M.fire({icon:"error",title:"Gagal",text:"Periksa kembali isian form Anda."})}})};return e.jsx(D,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 dark:bg-zinc-950",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Buat Transaksi Barang Keluar"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Distribusikan barang ke lokasi tujuan"})]}),e.jsxs("form",{onSubmit:L,className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-zinc-700 dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b border-gray-100 pb-6 md:grid-cols-2 lg:grid-cols-4 dark:border-zinc-800",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tanggal"}),e.jsx("input",{type:"date",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:n.tanggal,onChange:r=>m("tanggal",r.target.value)}),d.tanggal&&e.jsx("p",{className:"text-xs text-red-500",children:d.tanggal})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tujuan Distribusi"}),e.jsx("input",{type:"text",list:"lokasi-suggest",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:n.lokasi,onChange:r=>{m("lokasi",r.target.value),m("sub_lokasi","")},placeholder:"Pilih lokasi tujuan..."}),e.jsx("datalist",{id:"lokasi-suggest",children:s.map(r=>e.jsx("option",{value:r.nama},r.id))}),d.lokasi&&e.jsx("p",{className:"text-xs text-red-500",children:d.lokasi})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Sub-Lokasi",C&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(memuat...)"})]}),e.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:n.sub_lokasi,onChange:r=>m("sub_lokasi",r.target.value),disabled:!n.lokasi||c.length===0,children:[e.jsx("option",{value:"",children:"-- Pilih Sub-Lokasi --"}),c.map(r=>e.jsxs("option",{value:r.nama,children:[r.nama," ",r.lantai?`(Lt. ${r.lantai})`:""]},r.id))]}),d.sub_lokasi&&e.jsx("p",{className:"text-xs text-red-500",children:d.sub_lokasi})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"PIC (Penanggung Jawab)"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:n.pic,onChange:r=>m("pic",r.target.value),placeholder:"Nama penanggung jawab..."}),d.pic&&e.jsx("p",{className:"text-xs text-red-500",children:d.pic})]})]}),n.items.map((r,l)=>{const u={},y=`items.${l}.`;for(const a in d)if(a.startsWith(y)){const t=a.substring(y.length);u[t]=d[a]}const S=n.items.filter((a,t)=>t!==l).map(a=>a.model).filter(Boolean);return e.jsx(F,{item:r,index:l,onItemChange:N,onRemove:n.items.length>1?()=>z(l):void 0,errors:u,lists:{kategoriList:o,merekList:k,modelList:p,serialNumberList:g},usedModels:S},l)}),e.jsxs("div",{className:"mt-8 flex flex-col items-center justify-between gap-4 border-t border-gray-100 pt-6 sm:flex-row dark:border-zinc-800",children:[e.jsxs("button",{type:"button",onClick:_,className:"inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm transition hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Item"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(K,{href:route("barang-keluar.index"),className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-gray-300 dark:hover:bg-zinc-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Kembali"]}),e.jsx("button",{type:"submit",disabled:j,className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-2.5 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Simpan Transaksi"]})})]})]})]})]})})})}export{U as default};

import{a as y,u as L,j as e,L as S}from"./app-B0SzeqCG.js";import{A as C}from"./app-layout-BnD_lHqo.js";import{S as _}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-CWmUjKFj.js";import"./index-BAI3dK1t.js";import"./index-DjSeiq0_.js";import"./index-wkndwqac.js";import"./x-Ce74WkcZ.js";import"./createLucideIcon-DF5AlWng.js";import"./floating-ui.react-dom-Cbmwftv2.js";const K=({item:s,index:i,onItemChange:c,onRemove:b,errors:N,lists:n})=>{const o=n?.kategoriList||[],u=n?.merekList||[],k=n?.modelList||[];n?.serialNumberList;const h=n.kategoriList.find(a=>a.nama===s.kategori)?.id;n.merekList.filter(a=>a.model_barang.some(l=>l.jenis?.kategori_id===h));const m=n.merekList.find(a=>a.nama===s.merek)?.id;n.modelList.filter(a=>a.merek_id===m&&a.jenis?.kategori_id===h);const x=`${s.merek}|${s.model}`,j=n.serialNumberList[x]||[],v=s.keluar_info.map(a=>a.serial_number),f=j.filter(a=>!v.includes(a)),t=(a,l)=>{const r={...s,[a]:l};a==="kategori"?(r.merek="",r.model="",r.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]):a==="merek"&&(r.model="",r.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]),c(i,r)},d=(a,l,r)=>{const p=[...s.keluar_info];p[a]={...p[a],[l]:r},c(i,{...s,keluar_info:p})},g=()=>{const a=[...s.keluar_info,{serial_number:"",status_keluar:"dipinjamkan"}];c(i,{...s,keluar_info:a})},w=a=>{const l=s.keluar_info.filter((r,p)=>p!==a);c(i,{...s,keluar_info:l})};return e.jsxs("div",{className:"relative mb-6 rounded-lg border-2 border-gray-200 p-4",children:[e.jsxs("h3",{className:"mb-3 text-lg font-semibold text-gray-700",children:["Item #",i+1]}),b&&e.jsx("button",{type:"button",onClick:b,className:"absolute top-2 right-2 font-bold text-red-500 hover:text-red-700",children:"Ã— Hapus Item"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Kategori"}),e.jsx("input",{type:"text",list:"kategori-suggest",className:"mt-1 w-full rounded border p-2",value:s.kategori,onChange:a=>t("kategori",a.target.value)}),e.jsx("datalist",{id:"kategori-suggest",children:o.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Merek"}),e.jsx("input",{type:"text",list:`merek-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.merek,onChange:a=>t("merek",a.target.value)}),e.jsx("datalist",{id:`merek-suggest-${i}`,children:u.map(a=>e.jsx("option",{value:a.nama},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Model"}),e.jsx("input",{type:"text",list:`model-suggest-${i}`,className:"mt-1 w-full rounded border p-2",value:s.model,onChange:a=>t("model",a.target.value)}),e.jsx("datalist",{id:`model-suggest-${i}`,children:k.map(a=>e.jsx("option",{value:a.nama},a.id))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-red-700",children:"Serial Number & Status"}),s.keluar_info.map((a,l)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded border-2 border-red-400 bg-red-50 p-2",value:a.serial_number,onChange:r=>d(l,"serial_number",r.target.value),placeholder:`Serial #${l+1}`,list:`serial-suggest-${i}-${l}`}),e.jsx("datalist",{id:`serial-suggest-${i}-${l}`,children:f.map(r=>e.jsx("option",{value:r},r))}),s.keluar_info.length>1&&e.jsx("button",{type:"button",className:"text-sm text-red-600 hover:underline",onClick:()=>w(l),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.status_keluar,onChange:r=>d(l,"status_keluar",r.target.value),className:"w-full rounded border-2 border-blue-400 bg-blue-50 p-2",children:[e.jsx("option",{value:"dipinjamkan",children:"Dipinjamkan"}),e.jsx("option",{value:"dijual",children:"Dijual"}),e.jsx("option",{value:"maintenance",children:"Maintenance"})]})})]},l)),e.jsx("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:underline",onClick:g,children:"+ Tambah Serial"})]})]})};function P(){const{barangKeluar:s,lokasiList:i,kategoriList:c,merekList:b,modelList:N,serialNumberList:n}=y().props,{data:o,setData:u,put:k,processing:h,errors:m}=L({tanggal:s.tanggal,lokasi:s.lokasi,items:s.items}),x=(t,d)=>{const g=[...o.items];g[t]=d,u("items",g)},j=()=>{u("items",[...o.items,{kategori:"",merek:"",model:"",keluar_info:[{serial_number:"",status_keluar:"dipinjamkan"}]}])},v=t=>{u("items",o.items.filter((d,g)=>g!==t))},f=t=>{t.preventDefault(),k(route("barang-keluar.update",s.id),{onSuccess:()=>{_.fire({icon:"success",title:"Berhasil",text:"Data barang keluar berhasil diperbarui!",timer:2e3,showConfirmButton:!1})},onError:()=>{_.fire({icon:"error",title:"Gagal",text:"Periksa kembali isian form Anda."})}})};return e.jsx(C,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Edit Transaksi Barang Keluar"}),e.jsxs("form",{onSubmit:f,className:"rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b pb-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Tanggal"}),e.jsx("input",{type:"date",className:"mt-1 w-full rounded border p-2",value:o.tanggal,onChange:t=>u("tanggal",t.target.value)}),m.tanggal&&e.jsx("p",{className:"text-sm text-red-500",children:m.tanggal})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Tujuan Distribusi"}),e.jsx("input",{type:"text",list:"lokasi-suggest",className:"mt-1 w-full rounded border p-2",value:o.lokasi,onChange:t=>u("lokasi",t.target.value)}),e.jsx("datalist",{id:"lokasi-suggest",children:i.map(t=>e.jsx("option",{value:t.nama},t.id))}),m.lokasi&&e.jsx("p",{className:"text-sm text-red-500",children:m.lokasi})]})]}),o.items.map((t,d)=>e.jsx(K,{item:t,index:d,onItemChange:x,onRemove:o.items.length>1?()=>v(d):void 0,errors:m,lists:{kategoriList:c,merekList:b,modelList:N,serialNumberList:n}},d)),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:j,className:"rounded bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"+ Tambah Item"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(S,{href:route("barang-keluar.index"),className:"rounded bg-gray-500 px-6 py-2 text-white hover:bg-gray-600",children:"Kembali"}),e.jsx("button",{type:"submit",disabled:h,className:"rounded bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:"Perbarui Transaksi"})]})]})]})]})})}export{P as default};
